tabla,columna,tipo,nullable
# --- CAMBIOS 31/07/2025 ---
# - Se eliminó la vista/tabla 'cuarteles_completos' para evitar redundancia y confusión. Ahora toda la lógica y reportes usan la tabla principal 'cuarteles' y JOINs según necesidad.
# - Se actualizó la lógica de registro/login: el campo 'nombre' de usuarios ahora es el username (igual al email), y los campos reales de nombre y apellido son 'nombre_pila' y 'apellido'.
#   Los registros antiguos fueron migrados y los formularios actualizados para pedir nombre y apellido por separado.
# - Se mantiene la tabla de relación 'operario_finca' para soportar que un operario pueda trabajar en varias fincas del mismo productor (relación muchos a muchos). 'aplicadores_operarios' almacena los datos personales y 'operario_finca' las asignaciones.
#   Actualmente, la lógica principal usa 'aplicadores_operarios', pero la estructura está lista para futuras implementaciones multi-finca.
#
# --- MODELO DE PERMISOS Y ASIGNACIÓN DE OPERADORES ---
#
# Para permitir que un productor asigne permisos a los operadores (usuarios con acceso al sistema) para registrar y ver datos de sus fincas/cuarteles, se recomienda:
#
# 1. Usar la tabla 'usuarios' para los operadores (usuarios con acceso al sistema).
# 2. Usar la tabla 'fincas' para registrar la relación entre productor y finca (campo usuario_id).
# 3. Usar la tabla 'operario_finca' para asignar qué operadores pueden operar en cada finca. Esta tabla permite una relación muchos a muchos entre operadores y fincas.
# 4. (Opcional) Si se requiere granularidad a nivel de cuartel, se puede crear una tabla 'operador_cuartel' similar a 'operario_finca'.
#
# --- DISEÑO DE PERMISOS POR CUARTEL ---
#
# Si la lógica de permisos debe ser a nivel de cuartel (y no solo de finca), se recomienda:
#
# 1. Crear la tabla 'operador_cuartel' con la siguiente estructura:
#    operador_cuartel:
#      - operador_id (uuid, NO NULL)  -- referencia a usuarios.id (el operador)
#      - cuartel_id (bigint, NO NULL) -- referencia a cuarteles.id
#      - permiso (text, NO NULL)      -- tipo de permiso: 'lectura', 'registro', 'admin', etc.
#      - estado (text, NO NULL)       -- 'activo', 'pendiente', 'revocado', etc.
#      - created_at (timestamp, SI)
#
# 2. La asignación de permisos puede hacerse:
#    a) Antes de registrar el operador: el productor preasigna permisos a un email/usuario, y al registrarse se vincula automáticamente.
#    b) Después del registro: el productor busca y asigna permisos a operadores ya registrados.
#
# 3. La gestión de permisos debe estar disponible en la UI para el productor, permitiendo agregar, modificar o revocar permisos sobre cada cuartel.
#
# 4. La lógica de la app y las RLS deben consultar 'operador_cuartel' para determinar qué cuarteles puede ver o modificar cada operador.
#
# 5. Se recomienda mantener la tabla 'operario_finca' solo para casos donde se requiera asignación masiva o lógica heredada de permisos a nivel finca.
#
# Este modelo permite máxima granularidad y control sobre el acceso a los datos de cada cuartel.
#
# --- SQL DE CREACIÓN DE TABLA operador_cuartel ---
#
# CREATE TABLE operador_cuartel (
#   operador_id uuid NOT NULL REFERENCES usuarios(id),
#   cuartel_id bigint NOT NULL REFERENCES cuarteles(id),
#   permiso text NOT NULL, -- 'lectura', 'registro', 'admin', etc.
#   estado text NOT NULL,  -- 'activo', 'pendiente', 'revocado', etc.
#   created_at timestamp with time zone DEFAULT now(),
#   PRIMARY KEY (operador_id, cuartel_id)
# );
#
# --- FLUJO DE GESTIÓN DE PERMISOS EN LA UI (INTERFAZ DE USUARIO) ---
#
# 1. El productor accede a la gestión de un cuartel específico.
# 2. Ve una lista de operadores con acceso a ese cuartel y sus permisos actuales.
# 3. Puede:
#    - Agregar un operador (buscando por email o seleccionando de una lista de usuarios registrados).
#    - Asignar el tipo de permiso ('lectura', 'registro', 'admin', etc.).
#    - Cambiar o revocar permisos existentes.
#    - Preasignar permisos a un email (si el usuario aún no está registrado).
# 4. La app crea, actualiza o elimina registros en la tabla operador_cuartel según la acción.
# 5. Los operadores solo podrán ver/registrar datos en los cuarteles donde tengan permiso y estado 'activo'.
#
# Este flujo puede implementarse como un panel dentro de la vista de detalle de cada cuartel, o como una sección general de "Permisos/Operadores".
#
# Ejemplo de flujo:
# - El productor (usuario dueño de la finca) accede a la gestión de su finca y puede asignar operadores (usuarios) a través de la tabla 'operario_finca'.
# - Los operadores asignados podrán registrar y ver datos solo de las fincas/cuarteles a los que tengan permiso, según la lógica de la aplicación y las RLS en la base de datos.
# - La lógica de permisos se implementa en la app y en las políticas RLS de Supabase/Postgres, usando la relación de 'operario_finca'.
#
# Este modelo permite que el productor gestione los permisos de acceso de manera flexible y segura, y está preparado para futuras ampliaciones (por ejemplo, permisos por cuartel o por tipo de tarea).
# --------------------------
aplicadores_operarios,id,uuid,NO
aplicadores_operarios,nombre,text,NO
aplicadores_operarios,cuit,text,SI
aplicadores_operarios,telefono,text,SI
aplicadores_operarios,rol,text,SI
aplicadores_operarios,finca_id,bigint,SI
aplicadores_operarios,usuario_id,uuid,SI
aplicadores_operarios,created_at,timestamp with time zone,SI
aplicadores_operarios,apellido,text,SI
aplicadores_operarios,direccion,text,SI
cuartel_variedades,cuartel_id,bigint,NO
cuartel_variedades,variedad_id,uuid,NO
cuarteles,id,bigint,NO
cuarteles,finca_id,bigint,SI
cuarteles,superficie,numeric,SI
cuarteles,nro_viñedo,text,SI
cuarteles,provincia,text,SI
cuarteles,departamento,text,SI
cuarteles,created_at,timestamp with time zone,SI
cuarteles,nombre,text,NO
cuarteles,especie,text,SI
cuarteles,variedad,text,SI
cuarteles,especie_id,uuid,SI
cuarteles_completos,id,bigint,SI
cuarteles_completos,nombre,text,SI
cuarteles_completos,superficie,numeric,SI
cuarteles_completos,nro_viñedo,text,SI
cuarteles_completos,especie_texto,text,SI
cuarteles_completos,especie_nombre,text,SI
cuarteles_completos,especie_id,uuid,SI
cuarteles_completos,nombre_finca,text,SI
cuarteles_completos,finca_id,bigint,SI
cuarteles_completos,created_at,timestamp with time zone,SI
especies,id,uuid,NO
especies,nombre,text,NO
fertilizantes,id,uuid,NO
fertilizantes,producto,text,SI
fertilizantes,formula,text,SI
fertilizantes,n,numeric,SI
fertilizantes,p,numeric,SI
fertilizantes,k,numeric,SI
fertilizantes,ca,numeric,SI
fertilizantes,mg,numeric,SI
fertilizantes,s,numeric,SI
fertilizantes,fe,numeric,SI
fertilizantes,mn,numeric,SI
fertilizantes,zn,numeric,SI
fertilizantes,cu,numeric,SI
fertilizantes,bo,numeric,SI
fertilizantes,mo,numeric,SI
fertilizantes,cl,numeric,SI
fertilizantes,ph,text,SI
fertilizantes,otro,text,SI
fincas,id,bigint,NO
fincas,nombre_finca,text,NO
fincas,usuario_id,uuid,SI
fincas,created_at,timestamp with time zone,SI
fincas,direccion,text,SI
fincas,superficie,numeric,SI
fincas,provincia,text,SI
fincas,departamento,text,SI
fitosanitarios,id,bigint,NO
fitosanitarios,nombre_comercial,text,NO
fitosanitarios,principio_activo,text,SI
fitosanitarios,formulacion,text,SI
fitosanitarios,plaga_o_enfermedad,text,SI
fitosanitarios,accion,text,SI
fitosanitarios,tc_tiempo_carencia,text,SI
fitosanitarios,ct,text,SI
fitosanitarios,dosis_marbete,text,SI
fitosanitarios,unidad_marbete,text,SI
fitosanitarios,lmr_senasa,text,SI
fitosanitarios,lmr_eu,text,SI
fitosanitarios,uso,text,SI
fitosanitarios,dosis_frecuente_100l,text,SI
fitosanitarios,registro_para,text,SI
metodos_de_aplicacion,id,integer,NO
metodos_de_aplicacion,nombre,text,NO
metodos_de_aplicacion,descripcion,text,SI
operario_finca,operario_id,uuid,NO
operario_finca,finca_id,bigint,NO
operario_finca,estado,text,NO
organizaciones,id,uuid,NO
organizaciones,nombre,text,NO
organizaciones,logo_url,text,SI
organizaciones,color_base,text,SI
riegos,id,bigint,NO
riegos,finca_id,bigint,SI
riegos,cuartel_id,bigint,SI
riegos,variedad,text,SI
riegos,especie,text,SI
riegos,labores,text,SI
riegos,operador_id,uuid,SI
riegos,fecha,date,SI
riegos,maquinaria,text,SI
riegos,horas_riego,numeric,SI
riegos,volumen_agua,numeric,SI
riegos,observaciones,text,SI
riegos,created_at,timestamp with time zone,SI
riegos,labor,text,SI
riegos,objetivo,text,SI
tareas,id,bigint,NO
tareas,tipo_tarea_old,text,SI
tareas,fecha,date,SI
tareas,cuartel_id,bigint,SI
tareas,duracion,integer,SI
tareas,cant_agua,integer,SI
tareas,obs,text,SI
tareas,created_at,timestamp with time zone,SI
tareas,tipo_tarea_id,integer,SI
tipos_tarea,id,integer,NO
tipos_tarea,nombre,text,NO
tipos_tarea,requiere_duracion,boolean,SI
tipos_tarea,requiere_agua,boolean,SI
tipos_tarea,requiere_obs,boolean,SI
usuarios,id,uuid,NO
usuarios,nombre,text,SI
usuarios,cuit,text,SI
usuarios,telefono,text,SI
usuarios,rol,text,SI
usuarios,created_at,timestamp with time zone,SI
usuarios,organizacion_id,uuid,SI
usuarios,email,text,SI
variedades,id,uuid,NO
variedades,nombre,text,NO
variedades,color,text,SI
variedades,tipo_destino,text,SI
variedades,especie_id,uuid,SI
visitas,id,integer,NO
visitas,fecha,timestamp without time zone,NO
visitas,texto,text,NO
visitas,id_productor,uuid,NO
visitas,id_finca,bigint,SI
visitas,id_cuartel,bigint,SI
visitas,id_ingeniero,uuid,NO
visitas,adjuntos,jsonb,SI
visitas,enviado_mail,boolean,SI
fertilizaciones,id,bigint,NO
fertilizaciones,usuario_id,uuid,NO
fertilizaciones,finca_id,bigint,NO
fertilizaciones,cuartel_id,bigint,NO
fertilizaciones,fertilizante_id,uuid,NO
fertilizaciones,fecha,date,NO
fertilizaciones,dosis,numeric,NO
fertilizaciones,unidad_dosis,character varying,NO
fertilizaciones,metodo_aplicacion,character varying,NO
fertilizaciones,sistema_aplicacion,character varying,SI
fertilizaciones,superficie_aplicada,numeric,SI
fertilizaciones,operador_id,uuid,SI
fertilizaciones,equipo_trabajadores,text,SI
fertilizaciones,costo_total,numeric,SI
fertilizaciones,clima,character varying,SI
fertilizaciones,humedad_suelo,character varying,SI
fertilizaciones,observaciones,text,SI
fertilizaciones,created_at,timestamp with time zone,SI
fertilizaciones,updated_at,timestamp with time zone,SI
fertilizaciones,dosis_referencia,numeric,SI
fertilizaciones,unidad_dosis_referencia,character varying,SI
fertilizaciones,cantidad_aplicada,numeric,SI
fertilizaciones,unidad_cantidad,character varying,SI
fertilizaciones,superficie_cuartel,numeric,SI
fertilizaciones,dosis_real_calculada,numeric,SI

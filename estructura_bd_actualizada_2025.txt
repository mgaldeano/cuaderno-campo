ESQUEMA BASE DE DATOS - CUADERNO DE CAMPO
===============================================
Actualizado: 30 de julio de 2025
Estado: âœ… Validado y funcional

TABLAS PRINCIPALES:
==================

1. APLICADORES_OPERARIOS (ğŸ‘¥ Personas que trabajan en las fincas)
   - id (uuid, PK)
   - nombre (text, NOT NULL) âœ…
   - apellido (text) âœ… DISPONIBLE
   - cuit (text)
   - telefono (text) 
   - direccion (text)
   - rol (text) - ej: regador, tractorista
   - finca_id (bigint) - finca principal
   - usuario_id (uuid) - usuario del sistema
   - created_at (timestamp)

2. FINCAS (ğŸ¡ Propiedades agrÃ­colas)
   - id (bigint, PK)
   - nombre_finca (text, NOT NULL) âœ… USAR ESTE CAMPO
   - usuario_id (uuid) - propietario
   - direccion (text)
   - superficie (numeric) - hectÃ¡reas
   - provincia (text)
   - departamento (text)
   - created_at (timestamp)

3. CUARTELES (ğŸ—ºï¸ Subdivisiones de fincas)
   - id (bigint, PK)
   - nombre (text, NOT NULL)
   - finca_id (bigint, FK â†’ fincas.id)
   - superficie (numeric)
   - nro_viÃ±edo (text)
   - provincia (text)
   - departamento (text)
   - especie (text) - texto libre
   - variedad (text) - texto libre
   - especie_id (uuid, FK â†’ especies.id)
   - created_at (timestamp)

4. RIEGOS (ğŸ’§ Actividades de riego) â­ TABLA PRINCIPAL REPORTES
   - id (bigint, PK)
   - finca_id (bigint, FK â†’ fincas.id)
   - cuartel_id (bigint, FK â†’ cuarteles.id)
   - operador_id (uuid, FK â†’ aplicadores_operarios.id)
   - fecha (date)
   - variedad (text)
   - especie (text)
   - labor (text) âœ… DISPONIBLE
   - labores (text) âœ… DISPONIBLE
   - objetivo (text) âœ… DISPONIBLE - SE MUESTRA EN REPORTES
   - maquinaria (text)
   - horas_riego (numeric)
   - volumen_agua (numeric)
   - observaciones (text)
   - created_at (timestamp)

5. USUARIOS (ğŸ‘¥ Usuarios del sistema)
   - id (uuid, PK)
   - nombre (text)
   - email (text)
   - cuit (text)
   - telefono (text)
   - rol (text) âœ… DISPONIBLE - productor, ingeniero, operador
   - organizacion_id (uuid, FK â†’ organizaciones.id)
   - created_at (timestamp)

6. ESPECIES (ğŸŒ± CatÃ¡logo de especies)
   - id (uuid, PK)
   - nombre (text, NOT NULL) - Vid, Olivo, etc.

7. VARIEDADES (ğŸ‡ Variedades de cada especie)
   - id (uuid, PK)
   - nombre (text, NOT NULL)
   - color (text)
   - tipo_destino (text) - mesa, vino, etc.
   - especie_id (uuid, FK â†’ especies.id)

8. ORGANIZACIONES (ğŸ¢ Empresas/Cooperativas)
   - id (uuid, PK)
   - nombre (text, NOT NULL)
   - logo_url (text)
   - color_base (text)

9. FERTILIZANTES (ğŸ§ª CatÃ¡logo de fertilizantes)
   - id (uuid, PK)
   - producto (text) - nombre comercial
   - formula (text)
   - n, p, k, ca, mg, s (numeric) - composiciÃ³n
   - fe, mn, zn, cu, bo, mo, cl (numeric) - microelementos
   - ph (text)
   - otro (text)

10. FITOSANITARIOS (ğŸ› Productos fitosanitarios)
    - id (bigint, PK)
    - nombre_comercial (text, NOT NULL)
    - principio_activo (text)
    - formulacion (text)
    - plaga_o_enfermedad (text)
    - accion (text)
    - tc_tiempo_carencia (text)
    - ct (text) - clasificaciÃ³n toxicolÃ³gica
    - dosis_marbete (text)
    - unidad_marbete (text)
    - lmr_senasa (text)
    - lmr_eu (text)
    - uso (text)
    - dosis_frecuente_100l (text)
    - registro_para (text)

11. METODOS_DE_APLICACION (ğŸš¿ Formas de aplicar productos)
    - id (integer, PK)
    - nombre (text, NOT NULL)
    - descripcion (text)

12. TAREAS (ğŸ“‹ Tareas generales de campo)
    - id (bigint, PK)
    - fecha (date)
    - cuartel_id (bigint, FK â†’ cuarteles.id)
    - tipo_tarea_id (integer, FK â†’ tipos_tarea.id)
    - tipo_tarea_old (text) - campo legacy
    - duracion (integer) - minutos
    - cant_agua (integer)
    - obs (text)
    - created_at (timestamp)

13. TIPOS_TAREA (ğŸ“ Tipos de tareas)
    - id (integer, PK)
    - nombre (text, NOT NULL)
    - requiere_duracion (boolean)
    - requiere_agua (boolean)
    - requiere_obs (boolean)

14. VISITAS (ğŸ¥ Visitas tÃ©cnicas)
    - id (integer, PK)
    - fecha (timestamp, NOT NULL)
    - texto (text, NOT NULL) - contenido informe
    - id_productor (uuid, NOT NULL, FK â†’ usuarios.id)
    - id_finca (bigint, FK â†’ fincas.id)
    - id_cuartel (bigint, FK â†’ cuarteles.id)
    - id_ingeniero (uuid, NOT NULL, FK â†’ usuarios.id)
    - adjuntos (jsonb) - archivos adjuntos
    - enviado_mail (boolean)

TABLAS DE RELACIÃ“N:
==================

15. CUARTEL_VARIEDADES (ğŸ”— RelaciÃ³n N:M cuarteles-variedades)
    - cuartel_id (bigint, PK, FK â†’ cuarteles.id)
    - variedad_id (uuid, PK, FK â†’ variedades.id)

16. OPERARIO_FINCA (ğŸ¤ AsignaciÃ³n operarios-fincas)
    - operario_id (uuid, PK, FK â†’ aplicadores_operarios.id)
    - finca_id (bigint, PK, FK â†’ fincas.id)
    - estado (text, NOT NULL)

VISTAS:
=======

17. CUARTELES_COMPLETOS (ğŸ‘ï¸ Vista con informaciÃ³n combinada)
    - id (bigint) - del cuartel
    - nombre (text) - del cuartel
    - superficie (numeric)
    - nro_viÃ±edo (text)
    - especie_texto (text) - campo libre
    - especie_nombre (text) - del catÃ¡logo
    - especie_id (uuid)
    - nombre_finca (text) - nombre de la finca
    - finca_id (bigint)
    - created_at (timestamp)

CAMPOS CRÃTICOS PARA REPORTES:
==============================

âœ… riegos.objetivo - DISPONIBLE - Se muestra en reportes
âœ… aplicadores_operarios.apellido - DISPONIBLE - Formato "Apellido, Nombre"  
âœ… fincas.nombre_finca - USAR ESTE (NO fincas.nombre)
âœ… riegos.labor y riegos.labores - AMBOS DISPONIBLES
âœ… usuarios.rol - DISPONIBLE - para permisos

RELACIONES PRINCIPALES:
======================

usuarios (1) â†â†’ (N) fincas
fincas (1) â†â†’ (N) cuarteles
cuarteles (N) â†â†’ (M) variedades [via cuartel_variedades]
especies (1) â†â†’ (N) variedades
organizaciones (1) â†â†’ (N) usuarios
aplicadores_operarios (N) â†â†’ (M) fincas [via operario_finca]

riegos â†’ fincas (N:1)
riegos â†’ cuarteles (N:1)
riegos â†’ aplicadores_operarios (N:1)

tareas â†’ cuarteles (N:1)
tareas â†’ tipos_tarea (N:1)

visitas â†’ usuarios (N:1) [productor]
visitas â†’ usuarios (N:1) [ingeniero]
visitas â†’ fincas (N:1)
visitas â†’ cuarteles (N:1)

===============================================
âœ… Esquema validado el 30/07/2025
ğŸ”„ Ãšltima sincronizaciÃ³n: Funcional en reportes

ESQUEMA BASE DE DATOS - CUADERNO DE CAMPO
===============================================
Actualizado: 30 de julio de 2025
Estado: ✅ Validado y funcional

TABLAS PRINCIPALES:
==================

1. APLICADORES_OPERARIOS (👥 Personas que trabajan en las fincas)
   - id (uuid, PK)
   - nombre (text, NOT NULL) ✅
   - apellido (text) ✅ DISPONIBLE
   - cuit (text)
   - telefono (text) 
   - direccion (text)
   - rol (text) - ej: regador, tractorista
   - finca_id (bigint) - finca principal
   - usuario_id (uuid) - usuario del sistema
   - created_at (timestamp)

2. FINCAS (🏡 Propiedades agrícolas)
   - id (bigint, PK)
   - nombre_finca (text, NOT NULL) ✅ USAR ESTE CAMPO
   - usuario_id (uuid) - propietario
   - direccion (text)
   - superficie (numeric) - hectáreas
   - provincia (text)
   - departamento (text)
   - created_at (timestamp)

3. CUARTELES (🗺️ Subdivisiones de fincas)
   - id (bigint, PK)
   - nombre (text, NOT NULL)
   - finca_id (bigint, FK → fincas.id)
   - superficie (numeric)
   - nro_viñedo (text)
   - provincia (text)
   - departamento (text)
   - especie (text) - texto libre
   - variedad (text) - texto libre
   - especie_id (uuid, FK → especies.id)
   - created_at (timestamp)

4. RIEGOS (💧 Actividades de riego) ⭐ TABLA PRINCIPAL REPORTES
   - id (bigint, PK)
   - finca_id (bigint, FK → fincas.id)
   - cuartel_id (bigint, FK → cuarteles.id)
   - operador_id (uuid, FK → aplicadores_operarios.id)
   - fecha (date)
   - variedad (text)
   - especie (text)
   - labor (text) ✅ DISPONIBLE
   - labores (text) ✅ DISPONIBLE
   - objetivo (text) ✅ DISPONIBLE - SE MUESTRA EN REPORTES
   - maquinaria (text)
   - horas_riego (numeric)
   - volumen_agua (numeric)
   - observaciones (text)
   - created_at (timestamp)

5. USUARIOS (👥 Usuarios del sistema)
   - id (uuid, PK)
   - nombre (text)
   - email (text)
   - cuit (text)
   - telefono (text)
   - rol (text) ✅ DISPONIBLE - productor, ingeniero, operador
   - organizacion_id (uuid, FK → organizaciones.id)
   - created_at (timestamp)

6. ESPECIES (🌱 Catálogo de especies)
   - id (uuid, PK)
   - nombre (text, NOT NULL) - Vid, Olivo, etc.

7. VARIEDADES (🍇 Variedades de cada especie)
   - id (uuid, PK)
   - nombre (text, NOT NULL)
   - color (text)
   - tipo_destino (text) - mesa, vino, etc.
   - especie_id (uuid, FK → especies.id)

8. ORGANIZACIONES (🏢 Empresas/Cooperativas)
   - id (uuid, PK)
   - nombre (text, NOT NULL)
   - logo_url (text)
   - color_base (text)

9. FERTILIZANTES (🧪 Catálogo de fertilizantes)
   - id (uuid, PK)
   - producto (text) - nombre comercial
   - formula (text)
   - n, p, k, ca, mg, s (numeric) - composición
   - fe, mn, zn, cu, bo, mo, cl (numeric) - microelementos
   - ph (text)
   - otro (text)

10. FITOSANITARIOS (🐛 Productos fitosanitarios)
    - id (bigint, PK)
    - nombre_comercial (text, NOT NULL)
    - principio_activo (text)
    - formulacion (text)
    - plaga_o_enfermedad (text)
    - accion (text)
    - tc_tiempo_carencia (text)
    - ct (text) - clasificación toxicológica
    - dosis_marbete (text)
    - unidad_marbete (text)
    - lmr_senasa (text)
    - lmr_eu (text)
    - uso (text)
    - dosis_frecuente_100l (text)
    - registro_para (text)

11. METODOS_DE_APLICACION (🚿 Formas de aplicar productos)
    - id (integer, PK)
    - nombre (text, NOT NULL)
    - descripcion (text)

12. TAREAS (📋 Tareas generales de campo)
    - id (bigint, PK)
    - fecha (date)
    - cuartel_id (bigint, FK → cuarteles.id)
    - tipo_tarea_id (integer, FK → tipos_tarea.id)
    - tipo_tarea_old (text) - campo legacy
    - duracion (integer) - minutos
    - cant_agua (integer)
    - obs (text)
    - created_at (timestamp)

13. TIPOS_TAREA (📝 Tipos de tareas)
    - id (integer, PK)
    - nombre (text, NOT NULL)
    - requiere_duracion (boolean)
    - requiere_agua (boolean)
    - requiere_obs (boolean)

14. VISITAS (🏥 Visitas técnicas)
    - id (integer, PK)
    - fecha (timestamp, NOT NULL)
    - texto (text, NOT NULL) - contenido informe
    - id_productor (uuid, NOT NULL, FK → usuarios.id)
    - id_finca (bigint, FK → fincas.id)
    - id_cuartel (bigint, FK → cuarteles.id)
    - id_ingeniero (uuid, NOT NULL, FK → usuarios.id)
    - adjuntos (jsonb) - archivos adjuntos
    - enviado_mail (boolean)

TABLAS DE RELACIÓN:
==================

15. CUARTEL_VARIEDADES (🔗 Relación N:M cuarteles-variedades)
    - cuartel_id (bigint, PK, FK → cuarteles.id)
    - variedad_id (uuid, PK, FK → variedades.id)

16. OPERARIO_FINCA (🤝 Asignación operarios-fincas)
    - operario_id (uuid, PK, FK → aplicadores_operarios.id)
    - finca_id (bigint, PK, FK → fincas.id)
    - estado (text, NOT NULL)

VISTAS:
=======

17. CUARTELES_COMPLETOS (👁️ Vista con información combinada)
    - id (bigint) - del cuartel
    - nombre (text) - del cuartel
    - superficie (numeric)
    - nro_viñedo (text)
    - especie_texto (text) - campo libre
    - especie_nombre (text) - del catálogo
    - especie_id (uuid)
    - nombre_finca (text) - nombre de la finca
    - finca_id (bigint)
    - created_at (timestamp)

CAMPOS CRÍTICOS PARA REPORTES:
==============================

✅ riegos.objetivo - DISPONIBLE - Se muestra en reportes
✅ aplicadores_operarios.apellido - DISPONIBLE - Formato "Apellido, Nombre"  
✅ fincas.nombre_finca - USAR ESTE (NO fincas.nombre)
✅ riegos.labor y riegos.labores - AMBOS DISPONIBLES
✅ usuarios.rol - DISPONIBLE - para permisos

RELACIONES PRINCIPALES:
======================

usuarios (1) ←→ (N) fincas
fincas (1) ←→ (N) cuarteles
cuarteles (N) ←→ (M) variedades [via cuartel_variedades]
especies (1) ←→ (N) variedades
organizaciones (1) ←→ (N) usuarios
aplicadores_operarios (N) ←→ (M) fincas [via operario_finca]

riegos → fincas (N:1)
riegos → cuarteles (N:1)
riegos → aplicadores_operarios (N:1)

tareas → cuarteles (N:1)
tareas → tipos_tarea (N:1)

visitas → usuarios (N:1) [productor]
visitas → usuarios (N:1) [ingeniero]
visitas → fincas (N:1)
visitas → cuarteles (N:1)

===============================================
✅ Esquema validado el 30/07/2025
🔄 Última sincronización: Funcional en reportes
